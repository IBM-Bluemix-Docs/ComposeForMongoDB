---
copyright:
  years: 2016,2018
lastupdated: "2018-06-11"
---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}
{:tip: .tip}

# アーキテクチャー 
{: #architecture}

## 複製

{{site.data.keyword.composeForMongoDB_full}} サービスには、シングル・シャード構成の、3 つのデータ・ノードからなるレプリカ・セットがあります。 サービスがデプロイされる領域を選択すると、3 つのデータ・ノードはその領域のアベイラビリティー・ゾーンに分散され、データが 3 つすべてのノードに複製されます。 MongoDB は、すべての書き込み操作を 1 次データ・ノード上にプッシュし、oplog によってシャード上の 2 次データ・ノードに伝搬します。 1 次ノードに障害が起こると、2 次ノードが 1 次にプロモートされます。 1 つのデータ・メンバーが到達不能になっても、MongoDB シャードは引き続き正常に作動します。

## ディスクの暗号化

すべての {{site.data.keyword.composeForMongoDB}} サービスには、保存時の暗号化機能があります。 データは、ボリューム・レベルの暗号化が有効になっているサーバー上に配置されます。 

{{site.data.keyword.composeForMongoDB}} はマネージド・サービスであるので、{{site.data.keyword.cloud}} Compose のオペレーターはデータを見ることができます。 ディスクの暗号化に加えて、個人情報を保管する場合には、情報を暗号化してからデータベース内に保管するか、データベース自体に対して暗号化を有効にする拡張機能または機能を使用することをお勧めします。 これらの方法は使いやすさやパフォーマンスに影響することがありますが、個人情報を暗号化で保護するのは良い習慣です。

## 自動スケーリング

リソースは、MongoDB データベースのディスク・ストレージ合計使用量に基づいて自動的にスケーリングされます。 メモリーは、プロビジョンされるディスクとの比率が 1:4 になるように調整されます。 これらのリソースはユニットとしてバンドルされます。

自動スケーリングは、データベースの短期間から中期間のトレンドに対応するように設計されています。 サービスは 1 時間ごとに検査され、ディスク・スペースが不足している場合は、追加のユニットがデプロイメントに割り振られます。 

自動スケーリングにより、ディスク/メモリー使用量が縮小したデプロイメントのスケールが縮小されることはありません。 データベースにプロビジョンされたリソースは、将来の必要に備えて、手動でデプロイメントを縮小しない限り保持されます。
{: .tip}

## 管理データベース

管理データベースにデータを保管した場合は、パフォーマンスがあまり良くなく、データ損失のリスクもあります。

他の MongoDB インストール環境と同様に、{{site.data.keyword.composeForMongoDB}} にも管理データベースがあります。 管理データベースには、データベース内のユーザーおよび役割に関する情報が、さまざまなトラッキング・コレクションとともに保持されます。 単純な MongoDB インストール環境では、これが他のデータと一緒にデータベースに保管されます。 

{{site.data.keyword.composeForMongoDB}} では、回復力の高いアーキテクチャーが、MongoDB のシャード・アーキテクチャーを使用します。 このアーキテクチャーでは、シャード間で管理データを共有します。 そのために、管理データベースを含む別のデータベース・クラスターが作成されます。

このクラスター管理データベースは拡張できるように構築されておらず、少量でもデータが保管されるとすぐに性能が低下します。 したがって、アプリケーションは管理データベースにデータを書き込まないようにする必要があります。
